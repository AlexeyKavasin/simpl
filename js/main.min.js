"use strict";var simpl={SEC_IN_DAY:86400,secInPassedDays:86400,countdownIsOn:this.countdownIsOn||!1,cycleEnded:this.cycleEnded||!1,expense:0,initialLimit:localStorage.initialLimit||this.initialLimit||"",currentLimit:localStorage.currentLimit||this.currentLimit||"",startDeadLine:localStorage.startDeadLine||this.startDeadLine||"",deadLinePeriod:localStorage.deadLinePeriod||this.deadLinePeriod||"",endDeadLine:localStorage.endDeadLine||this.endDeadLine||"",expenseItems:localStorage.expenseItems||this.expenseItems||[],workingSpace:document.querySelector("#main"),adviserContainer:document.querySelector("#adviser-content-wrapper"),countdownContainer:document.querySelector("#countdown"),limitInputField:document.querySelector("#limit-field"),messageHide:this.messageHide||"",animateAdvise:this.animateAdvise||"",addListeners:function(){var e=simpl;e.workingSpace.addEventListener("click",e.btnAction)},setLimit:function(){var e=document.querySelector("#setlimit-field"),t=document.querySelector("#deadline-range");return this.cleanAdviser(),this.initialLimit=parseInt(e.value,10),this.deadLinePeriod=parseInt(t.value,10),this.deadLinePeriod<1||this.deadLinePeriod>7||this.initialLimit<0||isNaN(this.initialLimit)||this.initialLimit>29999?(this.showSystemMessage(this.systemMessages.limitErrorTxt,this.systemMessages.messageType.error,1e4),"Invalid value"):(this.limitInputField.value=this.initialLimit,localStorage.setItem("initialLimit",this.initialLimit),localStorage.setItem("secInPassedDays",this.secInPassedDays),this.setInitialTimer(),setTimeout(function(){this.countdownWork(),this.countdownContainer.style.display="block"}.bind(this),1e3),this.controlsState(),this.currentLimit=this.initialLimit,localStorage.setItem("currentLimit",this.currentLimit),this.initialLimit)},setInitialTimer:function(){this.startDeadLine=new Date,this.endDeadLine=new Date,this.endDeadLine.setDate(this.startDeadLine.getDate()+this.deadLinePeriod),localStorage.setItem("startDeadLine",this.startDeadLine),localStorage.setItem("endDeadLine",this.endDeadLine),localStorage.setItem("deadLinePeriod",this.deadLinePeriod),this.countdownIsOn=!0},countdownWork:function(){if(this.countdownIsOn){var e=new Date;if((e=Math.floor((this.endDeadLine-e)/1e3))<=0){for(;parseInt(localStorage.secInPassedDays,10)<this.deadLinePeriod*this.SEC_IN_DAY&&parseInt(localStorage.currentLimit,10)+parseInt(localStorage.initialLimit,10)<parseInt(localStorage.initialLimit,10)*this.deadLinePeriod;)this.renewLimit(parseInt(localStorage.initialLimit,10)),localStorage.setItem("secInPassedDays",this.secInPassedDays);return this.countdownIsOn=!1,this.cycleEnded=!0,this.endCycle(),!1}this.deadLinePeriod*this.SEC_IN_DAY-e>parseInt(localStorage.secInPassedDays,10)&&e>0&&(this.renewLimit(parseInt(localStorage.initialLimit,10)),this.secInPassedDays=parseInt(localStorage.secInPassedDays,10),this.secInPassedDays+=this.SEC_IN_DAY,localStorage.setItem("secInPassedDays",this.secInPassedDays));var t=e%60;e=Math.floor(e/60),t<10&&(t="0"+t);var i=e%60;e=Math.floor(e/60),i<10&&(i="0"+i);var s=e%(24*this.deadLinePeriod);e=Math.floor(e/24),s<10&&(s="0"+s),this.countdownContainer.innerHTML=s+":"+i+":"+t,setTimeout(function(){this.countdownWork()}.bind(this),1e3)}else this.countdownContainer.innerHTML="";return!0},limitSubtract:function(){var e=document.querySelector("#setexpense-value-field"),t=document.querySelector("#setexpense-name-field");if(this.expense=parseInt(e.value,10),Number.isInteger(this.expense)&&this.expense>0&&this.expense<3e4&&t.value){this.currentLimit=localStorage.currentLimit||this.initialLimit,this.currentLimit-=this.expense,localStorage.setItem("currentLimit",this.currentLimit),this.limitInputField.value=this.currentLimit;var i={name:t.value,price:this.expense};return this.addExpenseItem(i),this.checkColorIndicator(),this.currentLimit<-3e4?(this.countdownIsOn=!1,this.cycleEnded=!0,"Limit is exceeded"):this.currentLimit}return this.showSystemMessage(this.systemMessages.expenseErrorTxt,this.systemMessages.messageType.error,1e4),!1},addExpenseItem:function(e){localStorage.expenseItems&&(this.expenseItems=JSON.parse(localStorage.expenseItems));var t={name:e.name,price:e.price};this.expenseItems.length>=3&&this.expenseItems.pop(),this.expenseItems.unshift(t),localStorage.setItem("expenseItems",JSON.stringify(this.expenseItems)),this.showExpenseList()},showExpenseList:function(){this.cleanAdviser();var e=!0;if(localStorage.expenseItems&&(this.expenseItems=JSON.parse(localStorage.expenseItems),e=!1),!e){var t=document.createElement("ul");t.classList.add("expense-list"),this.adviserContainer.appendChild(t),t.innerHTML=this.expenseItems.map(function(e){return'<li class="expense-list__item">'+e.name+'<span class="expense-list__cash">'+e.price+"</span></li>"}).join("");for(var i=document.querySelectorAll(".expense-list__item"),s=0;s<i.length;s++)i[s].style.paddingRight=i[s].children[0].offsetWidth+24+"px"}},init:function(){if(this.addListeners(),this.controlsState(),localStorage.length){this.startDeadLine=new Date(Date.parse(localStorage.startDeadLine)),this.endDeadLine=new Date(Date.parse(localStorage.endDeadLine)),this.deadLinePeriod=localStorage.deadLinePeriod,this.secInPassedDays=localStorage.secInPassedDays,this.countdownIsOn=!0,this.controlsState(),this.checkColorIndicator(),this.countdownWork(),this.showExpenseList(),this.limitInputField.value=this.currentLimit,clearTimeout(e);var e=setTimeout(function(){this.countdownContainer.style.display="block"}.bind(this),1e3)}localStorage.currentLimit&&localStorage.currentLimit<-3e4&&(this.countdownIsOn=!1,this.cycleEnded=!0,this.endCycle())},renewLimit:function(e){this.currentLimit=parseInt(localStorage.currentLimit,10)||parseInt(localStorage.initialLimit,10),this.currentLimit+=e,this.limitInputField.value=this.currentLimit,localStorage.setItem("currentLimit",this.currentLimit),this.checkColorIndicator()},endCycle:function(){this.clearPopUpFields();var e=document.createElement("div");e.classList.add("pop-up"),e.innerHTML='<div class="pop-up__wrapper"><div id="end-verdict"></div><div id="end-stat"></div><div class="pop-up__controls"><button type="button" class="btn" id="final-reset" data-pop-id="end-pop-up">Ok</button></div></div>',this.workingSpace.appendChild(e),this.workingSpace.classList.add("pop-up-visible"),this.loadStat()},resetAll:function(){this.countdownIsOn=!1,this.cycleEnded=!1,this.controlsState(),this.cleanAdviser(),this.initialLimit="",this.currentLimit="",this.startDeadLine="",this.endDeadLine="",this.deadLinePeriod="",this.expenseItems=[],this.limitInputField.value="",localStorage.clear();for(var e=document.querySelectorAll(".pop-up"),t=0;t<e.length;t++)e[t].style.display="";this.secInPassedDays=86400,this.checkColorIndicator()},loadStat:function(){var e=document.querySelector("#end-verdict"),t=document.querySelector("#end-stat");console.log(e,t),this.initialLimit=parseInt(localStorage.initialLimit,10),this.currentLimit=parseInt(localStorage.currentLimit,10),this.deadLinePeriod=parseInt(localStorage.deadLinePeriod,10),this.limitInputField.value=this.currentLimit,!this.currentLimit||this.currentLimit>-3e4?e.innerHTML="<p>Time is up</p><br>":e.innerHTML="<p>Purchase limit exceeded</p>",this.currentLimit&&this.currentLimit!==this.initialLimit*this.deadLinePeriod?this.currentLimit<0?t.innerHTML="<p>Day limit: "+this.initialLimit+"</p><p>Period (days): "+this.deadLinePeriod+"</p><p>Spent: "+(this.initialLimit*this.deadLinePeriod+Math.abs(this.currentLimit))+"</p><p>Overspent: "+Math.abs(this.currentLimit)+"</p><p>Try again.</p>":t.innerHTML="<p>Day limit: "+this.initialLimit+"</p><p>Period (days): "+this.deadLinePeriod+"</p><p>Spent: "+(this.initialLimit*this.deadLinePeriod-this.currentLimit)+"</p><p>Saved: "+this.currentLimit+"</p><p>Try again.</p>":t.innerHTML="<p>Day limit: "+this.initialLimit+"</p><p>Period (days): "+this.deadLinePeriod+"</p><p>Spent: 0</p><p>Saved: "+this.initialLimit+"</p><p>Probably you did it wrong or didn't write down your purchases. Try again.</p>"},checkColorIndicator:function(){parseInt(localStorage.currentLimit,10)<0?this.limitInputField.classList.add("negative-balance"):this.limitInputField.classList.remove("negative-balance")},controlsState:function(){var e=document.querySelectorAll(".btn");if(this.countdownIsOn){document.body.classList.add("in-process");for(var t=0;t<e.length;t++)e[t].classList.contains("init-load-btn")?e[t].disabled=!0:e[t].disabled=!1}else for(document.body.classList.remove("in-process"),t=0;t<e.length;t++)e[t].classList.contains("in-process-btn")?e[t].disabled=!0:e[t].disabled=!1},togglePopUp:function(e,t){if(this.clearPopUpFields(),this.workingSpace.classList.contains("pop-up-visible")){this.workingSpace.classList.remove("pop-up-visible");var i=this.workingSpace.children;if(i.length)for(var s=0;s<i.length;s++)i[s].classList.contains("pop-up")&&this.removePopUp(i[s].id)}else console.log("works"),this.fillPopUp(e,t),this.workingSpace.classList.add("pop-up-visible");this.cycleEnded&&this.endCycle()},fillPopUp:function(e,t){var i=document.createElement("div");i.classList.add("pop-up"),i.id=e,"setlimit-pop-up"===e&&(i.innerHTML='<div class="pop-up__wrapper"><p class="pop-up__p">Set your day limit<br> 1 - 29999</p><div class="pop-up__field-wrapper"><input type="number" class="pop-up__field" id="setlimit-field" min="1" max="29999" step="1" autofocus></div><p class="pop-up__p">Set a period<br> 1 - 7 (days)</p><div class="pop-up__field-wrapper custom-range"><input type="range" id="deadline-range" min="1" max="7" step="1" value="1"></div><div class="pop-up__field-wrapper"><input type="text" class="pop-up__field" id="deadline-range-output" value="1"></div><div class="pop-up__controls"><button type="button" class="btn" id="setlimit-submit" data-pop-id="setlimit-pop-up">Ok</button><button type="button" class="btn" id="setlimit-cancel" data-pop-id="setlimit-pop-up">Cancel</button></div></div>'),"rest-confirm-pop-up"===e&&(i.innerHTML='<div class="pop-up__wrapper"><p class="pop-up__p">Your progress will be lost. Continue?</p><br><div class="pop-up__controls"><button type="button" class="btn" id="reset-confirm" data-pop-id="rest-confirm-pop-up">Ok</button><button type="button" class="btn" id="reset-cancel" data-pop-id="rest-confirm-pop-up">Cancel</button></div></div>'),"setexpense-pop-up"===e&&(i.innerHTML='<div class="pop-up__wrapper"><p class="pop-up__p">Amount spent</p><div class="pop-up__field-wrapper"><input type="number" class="pop-up__field" id="setexpense-value-field" min="1" max="29999" step="1" value="" autofocus></div><p class="pop-up__p">Purchase description</p><div class="pop-up__field-wrapper"><input type="text" class="pop-up__field" maxlength="30" id="setexpense-name-field" value=""></div><div class="pop-up__controls"><button type="button" class="btn" id="setexpense-submit">Ok</button><button type="button" class="btn" id="setexpense-cancel" data-pop-id="setexpense-pop-up">Cancel</button></div></div>'),this.workingSpace.appendChild(i),t&&t()},removePopUp:function(e){var t=document.getElementById(e);this.workingSpace.removeChild(t)},clearPopUpFields:function(){for(var e=document.querySelectorAll(".pop-up__field"),t=0;t<e.length;t++)e[t].value=""},cleanAdviser:function(){clearInterval(this.animateAdvise),clearTimeout(this.messageHide),this.adviserContainer.innerHTML="",this.adviserContainer.className="",this.adviserContainer.classList.add("adviser__wrapper")},btnAction:function(e){var t=simpl,i=e.target.id,s=e.target.classList.contains("btn"),n=e.target.dataset.popId;s&&("final-reset"===i||"reset-confirm"===i?(t.resetAll(),t.togglePopUp(n)):"setlimit-submit"===i?(t.setLimit(),t.togglePopUp(n)):"setexpense-submit"===i?(t.limitSubtract(),this.cycleEnded||t.togglePopUp(n)):"set-limit-btn"===i?t.togglePopUp(n,function(){var e=document.querySelector("#deadline-range"),t=document.querySelector("#deadline-range-output");e.addEventListener("input",function(){t.value=e.value})}):t.togglePopUp(n))},showSystemMessage:function(e,t,i){var s=0;this.cleanAdviser(),this.animateAdvise=setInterval(function(){this.adviserContainer.innerHTML+=e[s],++s===e.length&&(clearInterval(this.animateAdvise),this.adviserContainer.innerHTML+='<span class="blinking-cursor">&nbsp;</span>',this.adviserContainer.classList.add(t))}.bind(this),30),this.messageHide=setTimeout(function(){this.cleanAdviser(),this.showExpenseList()}.bind(this),i=i||5e3)},systemMessages:{expenseErrorTxt:"Invalid value. Valid purchase amount is from 1 to 29999, purchase description field can't be empty ",limitErrorTxt:"Invalid value. Valid limit: 1 to 29999. Valid period: 1 - 7 days ",messageType:{error:"error-message-open",regular:"regular-message-open"}}};simpl.init();