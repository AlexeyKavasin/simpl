"use strict";var simpl={SEC_IN_DAY:86400,secInPassedDays:86400,countdownIsOn:this.countdownIsOn||!1,cycleEnded:this.cycleEnded||!1,expense:0,initialLimit:localStorage.initialLimit||this.initialLimit||"",currentLimit:localStorage.currentLimit||this.currentLimit||"",startDeadLine:localStorage.startDeadLine||this.startDeadLine||"",deadLinePeriod:localStorage.deadLinePeriod||this.deadLinePeriod||"",endDeadLine:localStorage.endDeadLine||this.endDeadLine||"",expenseItems:localStorage.expenseItems||this.expenseItems||[],workingSpace:document.querySelector("#main"),adviserContainer:document.querySelector("#adviser-content-wrapper"),countdownContainer:document.querySelector("#countdown"),limitInputField:document.querySelector("#limit-field"),messageHide:this.messageHide||"",animateAdvise:this.animateAdvise||"",addListeners:function(){window.addEventListener("click",function(e){var t=e.target.id,i=e.target.classList.contains("btn"),s=e.target.dataset.popId;i&&("final-reset"===t||"reset-confirm"===t?(this.resetAll(),this.togglePopUp(s)):"setlimit-submit"===t?(this.setLimit(),this.togglePopUp(s)):"setexpense-submit"===t?(this.limitSubtract(),this.cycleEnded||this.togglePopUp(s)):"set-limit-btn"===t?this.togglePopUp(s,function(){var e=document.querySelector("#deadline-range"),t=document.querySelector("#deadline-range-output");e.addEventListener("input",function(){t.value=e.value})}):this.togglePopUp(s))}.bind(this))},setLimit:function(){var e=document.querySelector("#setlimit-field"),t=document.querySelector("#deadline-range");return this.cleanAdviser(),this.initialLimit=parseInt(e.value,10),this.deadLinePeriod=parseInt(t.value,10),this.deadLinePeriod<1||this.deadLinePeriod>7||this.initialLimit<=0||isNaN(this.initialLimit)||this.initialLimit>29999?(this.showSystemMessage(this.systemMessages.limitErrorTxt,this.systemMessages.messageType.error,1e4),!1):(this.limitInputField.value=this.initialLimit,localStorage.setItem("initialLimit",this.initialLimit),localStorage.setItem("secInPassedDays",this.secInPassedDays),this.setInitialTimer(),setTimeout(function(){this.countdownWork(),this.countdownContainer.style.display="block"}.bind(this),1e3),this.controlsState(),this.currentLimit=this.initialLimit,localStorage.setItem("currentLimit",this.currentLimit),this.initialLimit)},setInitialTimer:function(){this.startDeadLine=new Date,this.endDeadLine=new Date,this.endDeadLine.setDate(this.startDeadLine.getDate()+this.deadLinePeriod),localStorage.setItem("startDeadLine",this.startDeadLine),localStorage.setItem("endDeadLine",this.endDeadLine),localStorage.setItem("deadLinePeriod",this.deadLinePeriod),this.countdownIsOn=!0},countdownWork:function(){if(this.countdownIsOn){var e=new Date;if((e=Math.floor((this.endDeadLine-e)/1e3))<=0){for(;parseInt(localStorage.secInPassedDays,10)<this.deadLinePeriod*this.SEC_IN_DAY&&parseInt(localStorage.currentLimit,10)+parseInt(localStorage.initialLimit,10)<parseInt(localStorage.initialLimit,10)*this.deadLinePeriod;)this.renewLimit(parseInt(localStorage.initialLimit,10)),localStorage.setItem("secInPassedDays",this.secInPassedDays);return this.countdownIsOn=!1,this.cycleEnded=!0,this.countdownContainer.style.display="",this.endCycle(),!1}this.deadLinePeriod*this.SEC_IN_DAY-e>parseInt(localStorage.secInPassedDays,10)&&e>0&&(this.renewLimit(parseInt(localStorage.initialLimit,10)),this.secInPassedDays=parseInt(localStorage.secInPassedDays,10),this.secInPassedDays+=this.SEC_IN_DAY,localStorage.setItem("secInPassedDays",this.secInPassedDays));var t=e%60;e=Math.floor(e/60),t<10&&(t="0"+t);var i=e%60;e=Math.floor(e/60),i<10&&(i="0"+i);var s=e%(24*this.deadLinePeriod);e=Math.floor(e/24),s<10&&(s="0"+s),this.countdownContainer.innerHTML=s+":"+i+":"+t,setTimeout(function(){this.countdownWork()}.bind(this),1e3)}else this.countdownContainer.innerHTML="";return!0},limitSubtract:function(){var e=document.querySelector("#setexpense-value-field"),t=document.querySelector("#setexpense-name-field");if(this.expense=parseInt(e.value,10),Number.isInteger(this.expense)&&this.expense>0&&this.expense<3e4&&t.value){this.currentLimit=localStorage.currentLimit||this.initialLimit,this.currentLimit-=this.expense,localStorage.setItem("currentLimit",this.currentLimit),this.limitInputField.value=this.currentLimit;var i={name:t.value,price:this.expense};return this.addExpenseItem(i),this.checkColorIndicator(),this.currentLimit<-3e4?(this.countdownIsOn=!1,this.cycleEnded=!0,"Limit is exceeded"):this.currentLimit}return this.showSystemMessage(this.systemMessages.expenseErrorTxt,this.systemMessages.messageType.error,1e4),!1},addExpenseItem:function(e){localStorage.expenseItems&&(this.expenseItems=JSON.parse(localStorage.expenseItems));var t={name:e.name,price:e.price};this.expenseItems.length>=3&&this.expenseItems.pop(),this.expenseItems.unshift(t),localStorage.setItem("expenseItems",JSON.stringify(this.expenseItems)),this.showExpenseList()},showExpenseList:function(){this.cleanAdviser();var e=!0;if(localStorage.expenseItems&&(this.expenseItems=JSON.parse(localStorage.expenseItems),e=!1),!e){var t=document.createElement("ul");t.classList.add("expense-list"),this.adviserContainer.appendChild(t),t.innerHTML=this.expenseItems.map(function(e){return'<li class="expense-list__item">'+e.name+'<span class="expense-list__cash">'+e.price+"</span></li>"}).join("");document.querySelectorAll(".expense-list__item").forEach(function(e){e.style.paddingRight=e.children[0].offsetWidth+24+"px"})}},init:function(){if(this.addListeners(),this.controlsState(),localStorage.length){this.startDeadLine=new Date(Date.parse(localStorage.startDeadLine)),this.endDeadLine=new Date(Date.parse(localStorage.endDeadLine)),this.deadLinePeriod=localStorage.deadLinePeriod,this.secInPassedDays=localStorage.secInPassedDays,this.countdownIsOn=!0,this.controlsState(),this.checkColorIndicator(),this.countdownWork(),this.showExpenseList(),this.limitInputField.value=this.currentLimit,clearTimeout(e);var e=setTimeout(function(){this.countdownContainer.style.display="block"}.bind(this),1e3)}localStorage.currentLimit&&localStorage.currentLimit<-3e4&&(this.countdownIsOn=!1,this.cycleEnded=!0,this.endCycle())},renewLimit:function(e){this.currentLimit=parseInt(localStorage.currentLimit,10)||parseInt(localStorage.initialLimit,10),this.currentLimit+=e,this.limitInputField.value=this.currentLimit,localStorage.setItem("currentLimit",this.currentLimit),this.checkColorIndicator()},endCycle:function(){this.clearPopUpFields();var e=document.createElement("div");e.classList.add("pop-up"),e.innerHTML='<div class="pop-up__wrapper">\n      <div id="end-verdict"></div>\n      <div id="end-stat"></div>\n      <div class="pop-up__controls">\n        <button type="button" class="btn" id="final-reset" data-pop-id="end-pop-up" data-submit="ok">Ok</button>\n      </div>\n    </div>',this.workingSpace.appendChild(e),this.workingSpace.classList.add("pop-up-visible"),this.loadStat()},resetAll:function(){this.countdownIsOn=!1,this.cycleEnded=!1,this.controlsState(),this.cleanAdviser(),this.initialLimit="",this.currentLimit="",this.startDeadLine="",this.endDeadLine="",this.deadLinePeriod="",this.expenseItems=[],this.limitInputField.value="",localStorage.clear(),document.querySelectorAll(".pop-up").forEach(function(e){e.style.display=""}),this.secInPassedDays=86400,this.checkColorIndicator()},loadStat:function(){var e=document.querySelector("#end-verdict"),t=document.querySelector("#end-stat");this.initialLimit=parseInt(localStorage.initialLimit,10),this.currentLimit=parseInt(localStorage.currentLimit,10),this.deadLinePeriod=parseInt(localStorage.deadLinePeriod,10),this.limitInputField.value=this.currentLimit,!this.currentLimit||this.currentLimit>-3e4?e.innerHTML="<p>Time is up</p>":e.innerHTML="<p>Purchase limit exceeded</p>",this.currentLimit&&this.currentLimit!==this.initialLimit*this.deadLinePeriod?this.currentLimit<0?t.innerHTML="<p>Day limit: "+this.initialLimit+"</p>\n      <p>Period (days): "+this.deadLinePeriod+"</p>\n      <p>Spent: "+(this.initialLimit*this.deadLinePeriod+Math.abs(this.currentLimit))+"</p>\n      <p>Overspent: "+Math.abs(this.currentLimit)+"</p>\n      <p>Try again.</p>":t.innerHTML="<p>Day limit: "+this.initialLimit+"</p>\n      <p>Period (days): "+this.deadLinePeriod+"</p>\n      <p>Spent: "+(this.initialLimit*this.deadLinePeriod-this.currentLimit)+"</p>\n      <p>Saved: "+this.currentLimit+"</p>\n      <p>Try again.</p>":t.innerHTML="<p>Day limit: "+this.initialLimit+"</p>\n      <p>Period (days): "+this.deadLinePeriod+"</p> //посчитать количество прошедших (secInPassedDays) если оно не совпадает с изначально заданным\n      <p>Spent: 0</p>\n      <p>Saved: "+this.initialLimit+"</p>\n      <p>Probably you did it wrong or didn&#39;t write down your purchases. Try again.</p>"},checkColorIndicator:function(){parseInt(localStorage.currentLimit,10)<0?this.limitInputField.classList.add("negative-balance"):this.limitInputField.classList.remove("negative-balance")},controlsState:function(){var e=document.querySelectorAll(".btn");this.countdownIsOn?(document.body.classList.add("in-process"),e.forEach(function(e){e.classList.contains("init-load-btn")?e.disabled=!0:e.disabled=!1})):(document.body.classList.remove("in-process"),e.forEach(function(e){e.classList.contains("in-process-btn")?e.disabled=!0:e.disabled=!1}))},togglePopUp:function(e,t){if(this.clearPopUpFields(),this.workingSpace.classList.contains("pop-up-visible")){this.workingSpace.classList.remove("pop-up-visible");var i=this.workingSpace.children;if(i.length)for(var s=0;s<i.length;s++)i[s].classList.contains("pop-up")&&this.workingSpace.removeChild(i[s])}else this.fillPopUp(e,t),this.workingSpace.classList.add("pop-up-visible");this.cycleEnded&&this.endCycle()},fillPopUp:function(e,t){var i=document.createElement("div");i.classList.add("pop-up"),i.id=e,"setlimit-pop-up"===e&&(i.innerHTML='<div class="pop-up__wrapper">\n        <p class="pop-up__p">Set your day limit<br> 1 - 29999</p>\n        <div class="pop-up__field-wrapper">\n          <input type="number" class="pop-up__field" id="setlimit-field" min="1" max="29999" step="1" autofocus>\n        </div>\n        <p class="pop-up__p">Set a period<br> 1 - 7 (days)</p>\n        <div class="pop-up__field-wrapper custom-range">\n          <input type="range" id="deadline-range" min="1" max="7" step="1" value="1">\n        </div>\n        <div class="pop-up__field-wrapper">\n          <input type="text" class="pop-up__field" id="deadline-range-output" value="1" readonly>\n        </div>\n        <div class="pop-up__controls">\n          <button type="button" class="btn" id="setlimit-submit" data-pop-id="setlimit-pop-up" data-submit="ok">Ok</button>\n          <button type="button" class="btn" id="setlimit-cancel" data-pop-id="setlimit-pop-up" data-submit="cancel">Cancel</button>\n        </div>\n      </div>'),"rest-confirm-pop-up"===e&&(i.innerHTML='<div class="pop-up__wrapper">\n        <p class="pop-up__p">Your progress will be lost. Continue?</p><br>\n        <div class="pop-up__controls">\n          <button type="button" class="btn" id="reset-confirm" data-pop-id="rest-confirm-pop-up" data-submit="ok">Ok</button>\n          <button type="button" class="btn" id="reset-cancel" data-pop-id="rest-confirm-pop-up" data-submit="cancel">Cancel</button>\n        </div>\n      </div>'),"setexpense-pop-up"===e&&(i.innerHTML='<div class="pop-up__wrapper">\n        <p class="pop-up__p">Amount spent</p>\n        <div class="pop-up__field-wrapper">\n          <input type="number" class="pop-up__field" id="setexpense-value-field" min="1" max="29999" step="1" value="" autofocus>\n        </div>\n        <p class="pop-up__p">Purchase description</p>\n        <div class="pop-up__field-wrapper">\n          <input type="text" class="pop-up__field" maxlength="30" id="setexpense-name-field" value="">\n        </div>\n        <div class="pop-up__controls">\n          <button type="button" class="btn" id="setexpense-submit" data-submit="ok">Ok</button>\n          <button type="button" class="btn" id="setexpense-cancel" data-pop-id="setexpense-pop-up" data-submit="ok">Cancel</button>\n        </div>\n      </div>'),this.workingSpace.appendChild(i),t&&t()},clearPopUpFields:function(){document.querySelectorAll(".pop-up__field").forEach(function(e){e.value=""})},cleanAdviser:function(){clearInterval(this.animateAdvise),clearTimeout(this.messageHide),this.adviserContainer.innerHTML="",this.adviserContainer.className="",this.adviserContainer.classList.add("adviser__wrapper")},showSystemMessage:function(e,t,i){var s=0;this.cleanAdviser(),this.animateAdvise=setInterval(function(){this.adviserContainer.innerHTML+=e[s],++s===e.length&&(clearInterval(this.animateAdvise),this.adviserContainer.innerHTML+='<span class="blinking-cursor">&nbsp;</span>',this.adviserContainer.classList.add(t))}.bind(this),30),this.messageHide=setTimeout(function(){this.cleanAdviser(),this.showExpenseList()}.bind(this),8e3)},systemMessages:{expenseErrorTxt:"Invalid value. Valid purchase amount is from 1 to 29999, purchase description field can't be empty ",limitErrorTxt:"Invalid value. Valid limit: 1 to 29999. Valid period: 1 - 7 days ",messageType:{error:"error-message-open",regular:"regular-message-open"}}};simpl.init();