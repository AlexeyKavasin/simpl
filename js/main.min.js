"use strict";var simpl={SEC_IN_DAY:86400,secInPassedDays:86400,countdownIsOn:this.countdownIsOn||!1,expense:0,initialLimit:localStorage.initialLimit||this.initialLimit||"",currentLimit:localStorage.currentLimit||this.currentLimit||"",startDeadLine:localStorage.startDeadLine||this.startDeadLine||"",deadLinePeriod:localStorage.deadLinePeriod||this.deadLinePeriod||"",endDeadLine:localStorage.endDeadLine||this.endDeadLine||"",expenseItems:localStorage.expenseItems||this.expenseItems||[],workingSpace:document.querySelector("#main"),adviserContainer:document.querySelector("#adviser-content-wrapper"),countdownContainer:document.querySelector("#countdown"),limitInputField:document.querySelector("#limit-field"),setlimitField:document.querySelector("#setlimit-field"),deadlineRange:document.querySelector("#deadline-range-field"),endPopUp:document.querySelector("#end-pop-up"),rangeOutput:document.querySelector("#deadline-range-output"),messageHide:this.messageHide||"",animateAdvise:this.animateAdvise||"",setLimitPopUpFill:function(){var e=document.querySelector("#setlimit-pop-up");this.initialLimit=parseInt(this.setlimitField.value,10),this.deadLinePeriod=parseInt(this.deadlineRange.value,10),this.togglePopUpView(e),this.setLimit()},addListeners:function(){var e=simpl;e.deadlineRange.addEventListener("input",function(){e.rangeOutput.innerHTML=e.deadlineRange.value}),e.workingSpace.addEventListener("click",e.btnAction)},setLimit:function(){return this.cleanAdviser(),this.deadLinePeriod<1||this.deadLinePeriod>7||this.initialLimit<0||isNaN(this.initialLimit)||this.initialLimit>29999?(this.showSystemMessage(this.systemMessages.limitErrorTxt,this.systemMessages.messageType.error,1e4),"Invalid value"):(this.limitInputField.value=this.initialLimit,localStorage.setItem("initialLimit",this.initialLimit),localStorage.setItem("secInPassedDays",this.secInPassedDays),this.setInitialTimer(),setTimeout(function(){this.countdownWork(),this.countdownContainer.style.display="block"}.bind(this),1e3),this.controlsState(),this.currentLimit=this.initialLimit,localStorage.setItem("currentLimit",this.currentLimit),this.initialLimit)},setInitialTimer:function(){this.startDeadLine=new Date,this.endDeadLine=new Date,this.endDeadLine.setDate(this.startDeadLine.getDate()+this.deadLinePeriod),localStorage.setItem("startDeadLine",this.startDeadLine),localStorage.setItem("endDeadLine",this.endDeadLine),localStorage.setItem("deadLinePeriod",this.deadLinePeriod),this.countdownIsOn=!0},countdownWork:function(){if(this.countdownIsOn){var e=new Date;if((e=Math.floor((this.endDeadLine-e)/1e3))<=0){for(;parseInt(localStorage.secInPassedDays,10)<this.deadLinePeriod*this.SEC_IN_DAY&&parseInt(localStorage.currentLimit,10)+parseInt(localStorage.initialLimit,10)<parseInt(localStorage.initialLimit,10)*this.deadLinePeriod;)this.renewLimit(parseInt(localStorage.initialLimit,10)),localStorage.setItem("secInPassedDays",this.secInPassedDays);return this.countdownIsOn=!1,this.togglePopUpView(this.endPopUp),this.endPopUpFill(),!1}this.deadLinePeriod*this.SEC_IN_DAY-e>parseInt(localStorage.secInPassedDays,10)&&e>0&&(this.renewLimit(parseInt(localStorage.initialLimit,10)),this.secInPassedDays=parseInt(localStorage.secInPassedDays,10),this.secInPassedDays+=this.SEC_IN_DAY,localStorage.setItem("secInPassedDays",this.secInPassedDays));var t=e%60;e=Math.floor(e/60),t<10&&(t="0"+t);var i=e%60;e=Math.floor(e/60),i<10&&(i="0"+i);var s=e%(24*this.deadLinePeriod);e=Math.floor(e/24),s<10&&(s="0"+s),this.countdownContainer.innerHTML=s+":"+i+":"+t,setTimeout(function(){this.countdownWork()}.bind(this),1e3)}else this.countdownContainer.innerHTML="";return!0},setExpensePopUpFill:function(){var e=document.querySelector("#setexpense-pop-up"),t=document.querySelector("#setexpense-value-field");this.expense=parseInt(t.value,10),this.limitSubtract(),this.togglePopUpView(e)},limitSubtract:function(){var e=document.querySelector("#setexpense-name-field");if(Number.isInteger(this.expense)&&this.expense>0&&this.expense<3e4&&e.value){this.currentLimit=localStorage.currentLimit||this.initialLimit,this.currentLimit-=this.expense,localStorage.setItem("currentLimit",this.currentLimit),this.limitInputField.value=this.currentLimit;var t={name:e.value,price:this.expense};return this.addExpenseItem(t),this.checkColorIndicator(),this.currentLimit<-3e4?(this.countdownIsOn=!1,this.togglePopUpView(this.endPopUp),this.endPopUpFill(),"Limit is exceeded"):this.currentLimit}return this.showSystemMessage(this.systemMessages.expenseErrorTxt,this.systemMessages.messageType.error,1e4),!1},addExpenseItem:function(e){localStorage.expenseItems&&(this.expenseItems=JSON.parse(localStorage.expenseItems));var t={name:e.name,price:e.price};this.expenseItems.length>=3&&this.expenseItems.pop(),this.expenseItems.unshift(t),localStorage.setItem("expenseItems",JSON.stringify(this.expenseItems)),this.showExpenseList()},showExpenseList:function(){this.cleanAdviser();var e=!0;if(localStorage.expenseItems&&(this.expenseItems=JSON.parse(localStorage.expenseItems),e=!1),!e){var t=document.createElement("ul");t.classList.add("expense-list"),this.adviserContainer.appendChild(t),t.innerHTML=this.expenseItems.map(function(e){return'<li class="expense-list__item">'+e.name+'<span class="expense-list__cash">'+e.price+"</span></li>"}).join("");for(var i=document.querySelectorAll(".expense-list__item"),s=0;s<i.length;s++)i[s].style.paddingRight=i[s].children[0].offsetWidth+24+"px"}},init:function(){if(this.addListeners(),this.controlsState(),localStorage.currentLimit&&localStorage.currentLimit<-3e4&&(this.countdownIsOn=!1,this.togglePopUpView(this.endPopUp),this.endPopUpFill()),localStorage.length){this.startDeadLine=new Date(Date.parse(localStorage.startDeadLine)),this.endDeadLine=new Date(Date.parse(localStorage.endDeadLine)),this.deadLinePeriod=localStorage.deadLinePeriod,this.secInPassedDays=localStorage.secInPassedDays,this.countdownIsOn=!0,this.controlsState(),this.checkColorIndicator(),this.countdownWork(),this.showExpenseList(),this.limitInputField.value=this.currentLimit,clearTimeout(e);var e=setTimeout(function(){this.countdownContainer.style.display="block"}.bind(this),1e3)}},renewLimit:function(e){this.currentLimit=parseInt(localStorage.currentLimit,10)||parseInt(localStorage.initialLimit,10),this.currentLimit+=e,this.limitInputField.value=this.currentLimit,localStorage.setItem("currentLimit",this.currentLimit),this.checkColorIndicator()},restart:function(){this.countdownIsOn=!1,this.controlsState(),this.cleanAdviser(),this.initialLimit="",this.currentLimit="",this.startDeadLine="",this.endDeadLine="",this.deadLinePeriod="",this.expenseItems=[],this.limitInputField.value="",this.setlimitField.value="",localStorage.clear();for(var e=document.querySelectorAll(".pop-up"),t=0;t<e.length;t++)e[t].style.display="";this.secInPassedDays=86400,this.checkColorIndicator()},endPopUpFill:function(){var e=document.querySelector("#end-verdict"),t=document.querySelector("#end-stat");this.initialLimit=parseInt(localStorage.initialLimit,10),this.currentLimit=parseInt(localStorage.currentLimit,10),this.deadLinePeriod=parseInt(localStorage.deadLinePeriod,10),this.limitInputField.value=this.currentLimit,!this.currentLimit||this.currentLimit>-3e4?e.innerHTML="<p>Time is up</p><br>":e.innerHTML="<p>Purchase limit exceeded</p><br>",this.currentLimit&&this.currentLimit!==this.initialLimit*this.deadLinePeriod?this.currentLimit<0?t.innerHTML="<p>Day limit: "+this.initialLimit+"</p><p>Period (days): "+this.deadLinePeriod+"</p><p>Spent: "+(this.initialLimit*this.deadLinePeriod+Math.abs(this.currentLimit))+"</p><p>Overspent: "+Math.abs(this.currentLimit)+"</p><p>Try again.</p>":t.innerHTML="<p>Day limit: "+this.initialLimit+"</p><p>Period (days): "+this.deadLinePeriod+"</p><p>Spent: "+(this.initialLimit*this.deadLinePeriod-this.currentLimit)+"</p><p>Saved: "+this.currentLimit+"</p><p>Try again.</p>":t.innerHTML="<p>Day limit: "+this.initialLimit+"</p><p>Period (days): "+this.deadLinePeriod+"</p><p>Spent: 0</p><p>Saved: "+this.initialLimit+"</p><p>Probably you did it wrong or didn't write down your purchases. Try again.</p>"},checkColorIndicator:function(){parseInt(localStorage.currentLimit,10)<0?this.limitInputField.classList.add("negative-balance"):this.limitInputField.classList.remove("negative-balance")},controlsState:function(){var e=document.querySelectorAll(".btn");if(this.countdownIsOn){document.body.classList.add("in-process");for(var t=0;t<e.length;t++)e[t].classList.contains("init-load-btn")?e[t].disabled=!0:e[t].disabled=!1}else for(document.body.classList.remove("in-process"),t=0;t<e.length;t++)e[t].classList.contains("in-process-btn")?e[t].disabled=!0:e[t].disabled=!1},togglePopUpView:function(e){e.classList.toggle("pop-visible"),this.clearPopUpFields()},clearPopUpFields:function(){for(var e=document.querySelectorAll(".pop-up__field"),t=0;t<e.length;t++)e[t].value="";this.deadlineRange.value=1,this.rangeOutput.innerHTML=1},cleanAdviser:function(){clearInterval(this.animateAdvise),clearTimeout(this.messageHide),this.adviserContainer.innerHTML="",this.adviserContainer.className="",this.adviserContainer.classList.add("adviser__wrapper")},btnAction:function(e){var t=simpl,i=e.target.id,s=e.target.dataset.popId,n=document.getElementById(s);"set-limit-btn"===i||"reset-btn"===i||"limit-subtract-btn"===i||"restart-cancel"===i||"setlimit-cancel"===i||"setexpense-cancel"===i?t.togglePopUpView(n):"end-restart"===i||"restart-confirm"===i?(t.togglePopUpView(n),t.restart()):"setlimit-submit"===i?t.setLimitPopUpFill():"setexpense-submit"===i&&t.setExpensePopUpFill()},showSystemMessage:function(e,t,i){var s=0;this.cleanAdviser(),this.animateAdvise=setInterval(function(){this.adviserContainer.innerHTML+=e[s],++s===e.length&&(clearInterval(this.animateAdvise),this.adviserContainer.innerHTML+='<span class="blinking-cursor">&nbsp;</span>',this.adviserContainer.classList.add(t))}.bind(this),30),this.messageHide=setTimeout(function(){this.cleanAdviser(),this.showExpenseList()}.bind(this),i=i||5e3)},systemMessages:{expenseErrorTxt:"Invalid value. Valid purchase amount is from 1 to 29999, purchase description field can't be empty ",limitErrorTxt:"Invalid value. Valid limit: 1 to 29999. Valid period: 1 - 7 days ",messageType:{error:"error-message-open",regular:"regular-message-open"}}};simpl.init();